{% extends "tracking/base.html" %}
{% load static %}

{% block content %}
<style>
body {
    padding-top: 65px;
}

/* HEADER */
.page-header {
    text-align: center;
    margin-bottom: 2rem;
}
.page-header h2 {
    font-weight: 700;
    color: #007bff;
}
.page-header p {
    color: #6c757d;
}

/* SLIDESHOW */
.slideshow-container {
    position: relative;
    width: 100%;
    overflow: hidden;
    border-radius: 15px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}
.slides {
    display: flex;
    transition: transform 1s ease-in-out;
}
.slide {
    flex: 1 0 100%;
    position: relative;
}
.slide img {
    width: 100%;
    height: auto; /* keep full aspect ratio */
    display: block;
}

/* Overlay */
.slideshow-container::before {
    content: "";
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.45);
    z-index: 1;
    pointer-events: none;
}

/* FEATURE CARD */
.feature-card {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    padding: 2rem 2.5rem;
    color: #222;
    text-align: center;
    box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    font-size: 1.05rem;
    line-height: 1.5;
    transition: opacity 0.8s ease-in-out;
    cursor: pointer;
    margin-bottom: 1.5rem;
}
.feature-card i {
    font-size: 2.5rem;
    margin-bottom: 0.6rem;
    color: #007bff;
}
.feature-card h4 {
    font-weight: 700;
    margin-bottom: 0.5rem;
    font-size: 1.3rem;
}
.feature-card p {
    font-size: 1.05rem;
}

/* ARROWS */
.prev, .next {
    cursor: pointer;
    position: absolute;
    top: 50%;
    padding: 10px;
    margin-top: -20px;
    color: white;
    font-weight: bold;
    font-size: 1.5rem;
    background: rgba(0,0,0,0.4);
    border-radius: 50%;
    user-select: none;
    z-index: 3;
}
.prev:hover, .next:hover {
    background: rgba(0,0,0,0.7);
}
.prev { left: 10px; }
.next { right: 10px; }

/* DOTS */
.dots-container {
    text-align: center;
    position: absolute;
    bottom: 10px;
    width: 100%;
    z-index: 3;
}
.dot {
    cursor: pointer;
    height: 10px;
    width: 10px;
    margin: 0 4px;
    background-color: rgba(255,255,255,0.6);
    border-radius: 50%;
    display: inline-block;
    transition: background-color 0.3s ease;
}
.dot.active {
    background-color: #007bff;
}

/* RESPONSIVE */
@media (max-width: 768px) {
    .feature-card { padding: 1.5rem; }
}
</style>

<div class="container my-3">
    <!-- HEADER -->
    <div class="page-header">
        <h2>üìö Preterm Africa Study Highlights</h2>
    </div>

    <!-- FEATURE CARD (now before description) -->
    <div class="feature-card" id="feature-card"></div>
    <button id="continueBtn" class="btn btn-primary mt-3" style="display:none;">Continue</button>

    <!-- SLIDESHOW -->
    <div class="slideshow-container">
        <div class="slides" id="slides"></div>

        <a class="prev" onclick="changeSlide(-1)">‚ùÆ</a>
        <a class="next" onclick="changeSlide(1)">‚ùØ</a>

        <div class="dots-container" id="dots-container"></div>
    </div>
</div>

<script>
const slidesContainer = document.getElementById('slides');
const featureCard = document.getElementById('feature-card');
const dotsContainer = document.getElementById('dots-container');
const continueBtn = document.getElementById('continueBtn');

const studyHighlights = [
    { icon: "bi-bar-chart-line", title: "Global & Regional Mortality Trends", desc: "Neonatal deaths remain high in SSA, accounting for 43% of global newborn deaths despite a 59% decline in child mortality since 1990." },
    { icon: "bi-heart-pulse", title: "Causes of Neonatal Mortality", desc: "Prematurity complications and infections such as pneumonia drive most neonatal deaths, with RDS being a leading cause in LMICs." },
    { icon: "bi-diagram-3", title: "Income-Based Disparities", desc: "RDS mortality is ~2% in high-income countries but reaches 45% in LMICs, reflecting large gaps in resources and care." },
    { icon: "bi-flag", title: "WHO ENAP Goals", desc: "The Every Newborn Action Plan aims to scale access to CPAP, caffeine therapy, and surfactant for better newborn survival." },
    { icon: "bi-question-circle", title: "Knowledge Gaps", desc: "Limited high-quality SSA data on the combined impact of CPAP, caffeine, and LISA on preterm outcomes." },
    { icon: "bi-gear", title: "Need for Standardized Low-Cost CPAP", desc: "Locally made CPAP devices are often suboptimal; standardized low-cost versions may improve safety and effectiveness." },
    { icon: "bi-cup-hot", title: "Role of Caffeine", desc: "Caffeine citrate is safer and easier to use than aminophylline, but its LMIC CPAP-related impact is unknown." },
    { icon: "bi-cloud-arrow-down", title: "LISA Benefits", desc: "Less Invasive Surfactant Administration reduces CPAP failure in high-income countries, but LMIC benefits are unclear." },
    { icon: "bi-bullseye", title: "Study Objectives", desc: "Evaluate effectiveness and implementation of Vayu bCPAP, caffeine, and LISA in improving preterm survival." },
    { icon: "bi-calendar-range", title: "Study Phases", desc: "Hybrid Type I design: Phase 1 standardizes CPAP+caffeine; Phase 2 introduces LISA via stepped-wedge trial." },
    { icon: "bi-hospital", title: "Study Sites", desc: "Eight referral hospitals in Ghana, CAR, Nigeria, and Kenya serving low-income populations." },
    { icon: "bi-person-check", title: "Enrollment & Consent", desc: "24/7 newborn screening with informed consent in English or Swahili; Phase 2 randomization at site level." },
    { icon: "bi-clipboard-data", title: "Intervention Procedures", desc: "Phase 1: Vayu bCPAP+caffeine; Phase 2: add LISA; data collected on birth, care, and complications." },
    { icon: "bi-exclamation-triangle", title: "Safety & Monitoring", desc: "Defined serious adverse events per intervention; DSMB reviews safety at key recruitment milestones." },
    { icon: "bi-calculator", title: "Statistics & Sample Size", desc: "Target 1,512 subjects to detect mortality reduction; site quotas based on capacity and baseline rates." }
];

const imagePaths = [
    "{% static 'images/mothers1.jpg' %}",
    "{% static 'images/mothers2.jpg' %}",
    "{% static 'images/MLKH.jpg' %}",
    "{% static 'images/CGTRH.jpg' %}"
];

// Build slides dynamically
studyHighlights.forEach((topic, i) => {
    const imgSrc = imagePaths[i % imagePaths.length];
    const slideDiv = document.createElement('div');
    slideDiv.classList.add('slide');
    slideDiv.innerHTML = `<img src="${imgSrc}" alt="${topic.title}">`;
    slidesContainer.appendChild(slideDiv);

    const dot = document.createElement('span');
    dot.classList.add('dot');
    dot.onclick = () => goToSlide(i);
    dotsContainer.appendChild(dot);
});

let currentIndex = 0;
let autoSlideInterval;
let isPaused = false;
const dots = document.querySelectorAll('.dot');

function updateSlide() {
    slidesContainer.style.transform = `translateX(-${currentIndex * 100}%)`;
    const highlight = studyHighlights[currentIndex];
    featureCard.style.opacity = 0;
    setTimeout(() => {
        featureCard.innerHTML = `
            <i class="bi ${highlight.icon}"></i>
            <h4>${highlight.title}</h4>
            <p>${highlight.desc}</p>
        `;
        featureCard.style.opacity = 1;
    }, 300);
    dots.forEach((dot, idx) => dot.classList.toggle('active', idx === currentIndex));
}

function changeSlide(direction) {
    currentIndex = (currentIndex + direction + studyHighlights.length) % studyHighlights.length;
    updateSlide();
    if (!isPaused) resetAutoSlide();
}

function goToSlide(index) {
    currentIndex = index;
    updateSlide();
    if (!isPaused) resetAutoSlide();
}

function startAutoSlide() {
    autoSlideInterval = setInterval(() => {
        if (!isPaused) {
            currentIndex = (currentIndex + 1) % studyHighlights.length;
            updateSlide();
        }
    }, 4000);
}

function resetAutoSlide() {
    clearInterval(autoSlideInterval);
    startAutoSlide();
}

// Pause & Continue
featureCard.addEventListener('click', () => {
    isPaused = true;
    continueBtn.style.display = 'inline-block';
});
continueBtn.addEventListener('click', () => {
    isPaused = false;
    continueBtn.style.display = 'none';
});

updateSlide();
startAutoSlide();
</script>
{% endblock %}
