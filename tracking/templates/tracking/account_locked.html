{% extends "tracking/base.html" %}
{% load static %}

{% block title %}Account Locked{% endblock %}

{% block content %}
<div class="d-flex justify-content-center align-items-center" style="min-height:70vh;">
    <div class="card shadow p-4 text-center" style="max-width:450px; width:100%;">
        <div class="mb-3">
            <i class="bi bi-lock-fill text-danger" style="font-size:3rem;"></i>
        </div>
        <h2 class="fw-bold text-danger mb-3">Account Locked</h2>

        {% if permanent_lock %}
            <p class="mb-4">Your account has been permanently locked. Please contact an administrator to regain access.</p>
        {% else %}
            <p class="mb-2">Too many login attempts. Please try again later.</p>
            <p class="mb-4">You can try again in <span id="unlock-timer">{{ cool_off_seconds|default:1800 }}</span></p>
        {% endif %}

        <a href="{% url 'tracking:login' %}" class="btn btn-primary btn-lg">
            Back to Login
        </a>
    </div>
</div>

{% if not permanent_lock %}
<script>
(function(){
    let remainingSeconds = {{ cool_off_seconds|default:1800 }};
    const timerEl = document.getElementById('unlock-timer');

    function formatTime(sec){
        const m = Math.floor(sec / 60);
        const s = sec % 60;
        return `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }

    timerEl.textContent = formatTime(remainingSeconds);

    const interval = setInterval(()=>{
        remainingSeconds--;
        if(remainingSeconds <= 0){
            clearInterval(interval);
            timerEl.textContent = "00:00";
        } else {
            timerEl.textContent = formatTime(remainingSeconds);
        }
    }, 1000);
})();
</script>
{% endif %}
{% endblock %}
