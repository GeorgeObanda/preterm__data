{% extends "tracking/base.html" %}
{% block content %}
<div class="container-fluid px-0">
    <div class="d-flex justify-content-between align-items-center mb-3 px-3">
        <h2>
            Preterm Africa Patient Tracking Log
            {% if request.user.site %}
                ({{ request.user.site.name }})
            {% else %}
                (All Sites)
            {% endif %}
        </h2>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-hover align-middle text-center w-100"
               style="table-layout: fixed; font-size: 0.9rem;">
            <thead class="table-dark">
                <tr>
                    <th style="white-space: normal; text-align: center;">Study ID</th>
                    <th style="white-space: normal; text-align: center;">Admission Notes Day 1</th>
                    <th style="white-space: normal; text-align: center;">Enrollment Date</th>
                    <th style="white-space: normal; text-align: center;">Due Date</th>
                    <th style="white-space: normal; text-align: center;">Days Remaining</th>
                    <th style="white-space: normal; text-align: center;">Monitor Data Download</th>
                    <th style="white-space: normal; text-align: center;">Ultrasound Data Download</th>
                    <th style="white-space: normal; text-align: center;">Head US Image</th>
                    <th style="white-space: normal; text-align: center;">Head US Report</th>
                    <th style="white-space: normal; text-align: center;">CRF Uploaded</th>
                    <th style="white-space: normal; text-align: center;">Video Laryspe</th>
                    <th style="white-space: normal; text-align: center;">ROP Exam Done</th>
                    <th style="white-space: normal; text-align: center;">Cost Effectiveness Report</th>
                    <th style="white-space: normal; text-align: center;">Blood Culture Done</th>
                </tr>
            </thead>
            <tbody>
                {% for p in participants %}
                <tr>
                    <!-- Study ID -->
                    <td class="text-start" style="white-space: normal;">
                        <a href="{% url 'tracking:participant_detail' p.pk %}" class="text-decoration-none">
                            {{ p.study_id }}
                        </a>
                    </td>

                    <!-- Admission Notes Day 1 -->
                    <td style="white-space: normal;">{{ p.admission_notes_day1_uploaded|yesno:"✅,❌" }}</td>

                    <!-- Enrollment + Due -->
                    <td class="text-start" style="white-space: normal;">{{ p.enrollment_date }}</td>
                    <td class="text-start" style="white-space: normal;">{{ p.due_date }}</td>

                    <!-- Days Remaining -->
                    <td>
                        {% with days=p.days_remaining %}
                        <span class="badge rounded-pill px-3 py-2"
                              style="background-color:
                                  {% if days < 3 %}#dc3545
                                  {% elif days < 5 %}#fd7e14
                                  {% else %}#28a745
                                  {% endif %};
                                  color: white;">
                            {{ days }}
                        </span>
                        {% endwith %}
                    </td>

                    <!-- Data tracking -->
                    <td style="white-space: normal;">{{ p.monitor_downloaded|yesno:"✅,❌" }}</td>
                    <td style="white-space: normal;">{{ p.ultrasound_downloaded|yesno:"✅,❌" }}</td>
                    <td style="white-space: normal;">{{ p.head_ultrasound_images_uploaded|yesno:"✅,❌" }}</td>
                    <td style="white-space: normal;">{{ p.head_ultrasound_report_uploaded|yesno:"✅,❌" }}</td>
                    <td style="white-space: normal;">{{ p.case_report_form_uploaded|yesno:"✅,❌" }}</td>
                    <td style="white-space: normal;">{{ p.video_laryngoscope_uploaded|yesno:"✅,❌" }}</td>
                    <td style="white-space: normal;">{{ p.rop_final_report_uploaded|yesno:"✅,❌" }}</td>
                    <td style="white-space: normal;">{{ p.cost_effectiveness_data_uploaded|yesno:"✅,❌" }}</td>
                    <td style="white-space: normal;">{{ p.blood_culture_done|yesno:"✅,❌" }}</td>
                </tr>
                {% empty %}
                <tr><td colspan="14" class="text-center text-muted">No participants found.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {% include "tracking/components/back_button.html" %}
</div>
{% endblock %}
